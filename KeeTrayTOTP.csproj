<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <Configuration Condition=" '$(Configuration)' == '' ">Debug</Configuration>
    <Platform Condition=" '$(Platform)' == '' ">AnyCPU</Platform>
    <ProductVersion>8.0.30703</ProductVersion>
    <SchemaVersion>2.0</SchemaVersion>
    <ProjectGuid>{BF4A8A1F-B9B6-499C-8756-810B44895B8A}</ProjectGuid>
    <OutputType>Library</OutputType>
    <AppDesignerFolder>Properties</AppDesignerFolder>
    <RootNamespace>KeeTrayTOTP</RootNamespace>
    <AssemblyName>KeeTrayTOTP</AssemblyName>
    <TargetFrameworkVersion>v3.5</TargetFrameworkVersion>
    <FileAlignment>512</FileAlignment>
    <TargetFrameworkProfile>Client</TargetFrameworkProfile>
  </PropertyGroup>
  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Debug|AnyCPU' ">
    <DebugSymbols>true</DebugSymbols>
    <DebugType>full</DebugType>
    <Optimize>false</Optimize>
    <OutputPath>bin\Debug\</OutputPath>
    <DefineConstants>TRACE</DefineConstants>
    <ErrorReport>prompt</ErrorReport>
    <WarningLevel>4</WarningLevel>
    <Prefer32Bit>false</Prefer32Bit>
  </PropertyGroup>
  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Release|AnyCPU' ">
    <DebugType>pdbonly</DebugType>
    <Optimize>true</Optimize>
    <OutputPath>bin\Release\</OutputPath>
    <DefineConstants>TRACE</DefineConstants>
    <ErrorReport>prompt</ErrorReport>
    <WarningLevel>4</WarningLevel>
    <Prefer32Bit>false</Prefer32Bit>
  </PropertyGroup>
  <PropertyGroup>
    <ApplicationIcon>TOTP.ico</ApplicationIcon>
  </PropertyGroup>
  <PropertyGroup>
    <SignAssembly>false</SignAssembly>
  </PropertyGroup>
  <PropertyGroup>
    <AssemblyOriginatorKeyFile>
    </AssemblyOriginatorKeyFile>
  </PropertyGroup>
  <ItemGroup>
    <Reference Include="KeePass">
      <HintPath>..\..\..\..\..\..\..\..\Program Files (x86)\KeePass Password Safe 2\KeePass.exe</HintPath>
    </Reference>
    <Reference Include="System" />
    <Reference Include="System.Core" />
    <Reference Include="System.Data" />
    <Reference Include="System.Drawing" />
    <Reference Include="System.Windows.Forms" />
    <Reference Include="System.Xml" />
  </ItemGroup>
  <ItemGroup>
    <Compile Include="FormAbout.cs">
      <SubType>Form</SubType>
    </Compile>
    <Compile Include="FormAbout.Designer.cs">
      <DependentUpon>FormAbout.cs</DependentUpon>
    </Compile>
    <Compile Include="FormAbout_Localization.Designer.cs">
      <AutoGen>True</AutoGen>
      <DesignTime>True</DesignTime>
      <DependentUpon>FormAbout_Localization.resx</DependentUpon>
    </Compile>
    <Compile Include="FormHelp_Localization.Designer.cs">
      <AutoGen>True</AutoGen>
      <DesignTime>True</DesignTime>
      <DependentUpon>FormHelp_Localization.resx</DependentUpon>
    </Compile>
    <Compile Include="FormSettings_Localization.Designer.cs">
      <AutoGen>True</AutoGen>
      <DesignTime>True</DesignTime>
      <DependentUpon>FormSettings_Localization.resx</DependentUpon>
    </Compile>
    <Compile Include="SetupTOTP_Localization.Designer.cs">
      <DependentUpon>SetupTOTP_Localization.resx</DependentUpon>
      <AutoGen>True</AutoGen>
      <DesignTime>True</DesignTime>
    </Compile>
    <Compile Include="FormTimeCorrection_Localization.Designer.cs">
      <AutoGen>True</AutoGen>
      <DesignTime>True</DesignTime>
      <DependentUpon>FormTimeCorrection_Localization.resx</DependentUpon>
    </Compile>
    <Compile Include="Libraries\Base32.cs" />
    <Compile Include="Libraries\TimeCorrectionProvider.cs" />
    <Compile Include="Libraries\TOTPEncoder.cs" />
    <Compile Include="Setup.cs">
      <SubType>Form</SubType>
    </Compile>
    <Compile Include="Setup.Designer.cs">
      <DependentUpon>Setup.cs</DependentUpon>
    </Compile>
    <Compile Include="SetupTOTP.cs">
      <SubType>Form</SubType>
    </Compile>
    <Compile Include="SetupTOTP.Designer.cs">
      <DependentUpon>SetupTOTP.cs</DependentUpon>
    </Compile>
    <Compile Include="TrayTOTP_CustomColumn.cs" />
    <Compile Include="TrayTOTP_CustomColumn_Localization.Designer.cs">
      <AutoGen>True</AutoGen>
      <DesignTime>True</DesignTime>
      <DependentUpon>TrayTOTP_CustomColumn_Localization.resx</DependentUpon>
    </Compile>
    <Compile Include="TrayTOTP_Extensions.cs" />
    <Compile Include="FormHelp.cs">
      <SubType>Form</SubType>
    </Compile>
    <Compile Include="FormHelp.Designer.cs">
      <DependentUpon>FormHelp.cs</DependentUpon>
    </Compile>
    <Compile Include="FormSettings.cs">
      <SubType>Form</SubType>
    </Compile>
    <Compile Include="FormSettings.Designer.cs">
      <DependentUpon>FormSettings.cs</DependentUpon>
    </Compile>
    <Compile Include="FormTimeCorrection.cs">
      <SubType>Form</SubType>
    </Compile>
    <Compile Include="FormTimeCorrection.Designer.cs">
      <DependentUpon>FormTimeCorrection.cs</DependentUpon>
    </Compile>
    <Compile Include="Properties\AssemblyInfo.cs" />
    <Compile Include="Properties\Resources.Designer.cs">
      <AutoGen>True</AutoGen>
      <DesignTime>True</DesignTime>
      <DependentUpon>Resources.resx</DependentUpon>
    </Compile>
    <Compile Include="Libraries\TOTPProvider.cs" />
    <Compile Include="TrayTOTP_Extensions_Localization.Designer.cs">
      <AutoGen>True</AutoGen>
      <DesignTime>True</DesignTime>
      <DependentUpon>TrayTOTP_Extensions_Localization.resx</DependentUpon>
    </Compile>
    <Compile Include="TrayTOTP_Plugin.cs" />
    <Compile Include="TrayTOTP_Plugin_Localization.Designer.cs">
      <AutoGen>True</AutoGen>
      <DesignTime>True</DesignTime>
      <DependentUpon>TrayTOTP_Plugin_Localization.resx</DependentUpon>
    </Compile>
    <Compile Include="TrayTOTP_TimeCorrectionCollection.cs" />
    <Compile Include="TrayTOTP_TimeCorrectionCollection_Localization.Designer.cs">
      <AutoGen>True</AutoGen>
      <DesignTime>True</DesignTime>
      <DependentUpon>TrayTOTP_TimeCorrectionCollection_Localization.resx</DependentUpon>
    </Compile>
  </ItemGroup>
  <ItemGroup>
    <EmbeddedResource Include="FormAbout.resx">
      <DependentUpon>FormAbout.cs</DependentUpon>
      <SubType>Designer</SubType>
    </EmbeddedResource>
    <EmbeddedResource Include="FormAbout_Localization.resx">
      <Generator>ResXFileCodeGenerator</Generator>
      <LastGenOutput>FormAbout_Localization.Designer.cs</LastGenOutput>
    </EmbeddedResource>
    <EmbeddedResource Include="FormHelp.resx">
      <DependentUpon>FormHelp.cs</DependentUpon>
      <SubType>Designer</SubType>
    </EmbeddedResource>
    <EmbeddedResource Include="FormHelp_Localization.resx">
      <Generator>ResXFileCodeGenerator</Generator>
      <LastGenOutput>FormHelp_Localization.Designer.cs</LastGenOutput>
    </EmbeddedResource>
    <EmbeddedResource Include="FormSettings.resx">
      <DependentUpon>FormSettings.cs</DependentUpon>
      <SubType>Designer</SubType>
    </EmbeddedResource>
    <EmbeddedResource Include="FormSettings_Localization.resx">
      <Generator>ResXFileCodeGenerator</Generator>
      <LastGenOutput>FormSettings_Localization.Designer.cs</LastGenOutput>
    </EmbeddedResource>
    <EmbeddedResource Include="SetupTOTP_Localization.resx">
      <Generator>ResXFileCodeGenerator</Generator>
      <LastGenOutput>SetupTOTP_Localization.Designer.cs</LastGenOutput>
    </EmbeddedResource>
    <EmbeddedResource Include="FormTimeCorrection.resx">
      <DependentUpon>FormTimeCorrection.cs</DependentUpon>
    </EmbeddedResource>
    <EmbeddedResource Include="FormTimeCorrection_Localization.resx">
      <Generator>ResXFileCodeGenerator</Generator>
      <LastGenOutput>FormTimeCorrection_Localization.Designer.cs</LastGenOutput>
    </EmbeddedResource>
    <EmbeddedResource Include="Properties\Resources.resx">
      <Generator>ResXFileCodeGenerator</Generator>
      <LastGenOutput>Resources.Designer.cs</LastGenOutput>
      <SubType>Designer</SubType>
    </EmbeddedResource>
    <EmbeddedResource Include="SetupTOTP.resx">
      <DependentUpon>SetupTOTP.cs</DependentUpon>
    </EmbeddedResource>
    <EmbeddedResource Include="TrayTOTP_CustomColumn_Localization.resx">
      <Generator>ResXFileCodeGenerator</Generator>
      <LastGenOutput>TrayTOTP_CustomColumn_Localization.Designer.cs</LastGenOutput>
    </EmbeddedResource>
    <EmbeddedResource Include="TrayTOTP_Extensions_Localization.resx">
      <Generator>ResXFileCodeGenerator</Generator>
      <LastGenOutput>TrayTOTP_Extensions_Localization.Designer.cs</LastGenOutput>
    </EmbeddedResource>
    <EmbeddedResource Include="TrayTOTP_Plugin_Localization.resx">
      <Generator>ResXFileCodeGenerator</Generator>
      <LastGenOutput>TrayTOTP_Plugin_Localization.Designer.cs</LastGenOutput>
    </EmbeddedResource>
    <EmbeddedResource Include="TrayTOTP_TimeCorrectionCollection_Localization.resx">
      <Generator>ResXFileCodeGenerator</Generator>
      <LastGenOutput>TrayTOTP_TimeCorrectionCollection_Localization.Designer.cs</LastGenOutput>
    </EmbeddedResource>
  </ItemGroup>
  <ItemGroup>
    <None Include="Resources\textfield_key.png" />
  </ItemGroup>
  <ItemGroup>
    <None Include="Resources\bullet_key.png" />
  </ItemGroup>
  <ItemGroup>
    <None Include="Resources\bullet_delete.png" />
  </ItemGroup>
  <ItemGroup>
    <None Include="Resources\bullet_error.png" />
  </ItemGroup>
  <ItemGroup>
    <None Include="Resources\Equipment.png" />
    <None Include="Resources\Help symbol.png" />
    <None Include="Resources\Info.png" />
    <None Include="Resources\Magic wand.png" />
    <None Include="Resources\ContextMenu-Copy.png" />
    <None Include="Resources\ContextMenu-Setup.png" />
    <None Include="Resources\CustomColumn-Menu.png" />
    <None Include="Resources\EntryList.png" />
    <None Include="Resources\TrayMenu.png" />
    <None Include="Resources\StorageStrings.png" />
    <None Include="Resources\HelpMenu.png" />
    <None Include="Resources\ContextMenu.png" />
    <None Include="Resources\AutoType.png" />
    <None Include="Resources\bullet_lock.png" />
    <Content Include="TOTP.ico" />
  </ItemGroup>
  <Import Project="$(MSBuildToolsPath)\Microsoft.CSharp.targets" />
  <!-- To modify your build process, add your task inside one of the targets below and uncomment it. 
       Other similar extension points exist, see Microsoft.Common.targets.
  <Target Name="BeforeBuild">
  </Target>
  <Target Name="AfterBuild">
  </Target>
  -->
    <PropertyGroup Condition="'$(OS)' == 'Windows_NT'">
    <PostBuildEvent>
      echo POSTBUILDSTEP for $(ProjectName)

      REM set KPDir=c:\Program Files (x86)\KeePass Password Safe 2 DEV\
	  set KPDir=c:\Program Files (x86)\KeePass Password Safe 2\
      set KPPDir=%25KPDir%25plugins\
      set KPPTempDir=%25KPPDir%25$(ProjectName)

      IF NOT "$(ConfigurationName)"=="Debug" Goto :NotDebug
      REM In debug mode we want to move the generated DLLs and PDBs to the plugins
      REM directory so we can easily set breakpoints, etc.

      REM delete the PLGX from any previous ReleasePLGX build
      del /Q "%25KPPDir%25$(ProjectName).plgx"
      REM if errorlevel 1 goto BuildEventFailed
      echo Release plgx deleted

      REM copy output DLLs to KeePass plugins directory
      copy "$(ProjectName).dll" "%25KPPDir%25\$(ProjectName).dll"
      if errorlevel 1 goto BuildEventFailed
      copy "KeePassRPC.Mono.Security.dll" "%25KPPDir%25\KeePassRPC.Mono.Security.dll"
      copy "Jayrock.dll" "%25KPPDir%25\Jayrock.dll"
      copy "Jayrock.Json.dll" "%25KPPDir%25\Jayrock.Json.dll"
      copy "Fleck2.dll" "%25KPPDir%25\Fleck2.dll"
      copy "DomainPublicSuffix.dll" "%25KPPDir%25\DomainPublicSuffix.dll"
      if errorlevel 1 goto BuildEventFailed
      echo Debug DLLs copied to plugins directory

      goto BuildEventOK

      :NotDebug
      IF NOT "$(ConfigurationName)"=="ReleasePLGX" Goto :NotReleasePlgx
      REM In release mode we want to make sure that we are working with the PLGX version.
      REM This prevents debugging so should only be used when packaging a plgx file for
      REM distribution.

      REM delete the DLLs from any previous Debug build
      del /Q "%25KPPDir%25$(ProjectName).dll"
      if errorlevel 1 goto BuildEventFailed
      del /Q "%25KPPDir%25\KeePassRPC.Mono.Security.dll"
      del /Q "%25KPPDir%25\Jayrock.dll"
      del /Q "%25KPPDir%25\Jayrock.Json.dll"
      del /Q "%25KPPDir%25\Fleck2.dll"
      del /Q "%25KPPDir%25\DomainPublicSuffix.dll"
      if errorlevel 1 goto BuildEventFailed
      echo Debug DLLs deleted

      REM create temporary directory
      rmdir /S /Q "%25KPPTempDir%25"
      mkdir "%25KPPTempDir%25"
      if errorlevel 1 goto BuildEventFailed
      echo Temporary directory created

      REM copy relevant project files to temporary directory
      REM (for simple KeePass plugins you may need to
      REM copy only *.cs files and .csproj file)
      copy "KeePassRPC.Mono.Security.dll" "%25KPPTempDir%25\KeePassRPC.Mono.Security.dll"
      copy "Jayrock.dll" "%25KPPTempDir%25\Jayrock.dll"
      copy "Jayrock.Json.dll" "%25KPPTempDir%25\Jayrock.Json.dll"
      copy "Fleck2.dll" "%25KPPTempDir%25\Fleck2.dll"
      copy "DomainPublicSuffix.dll" "%25KPPTempDir%25\DomainPublicSuffix.dll"
      if errorlevel 1 goto BuildEventFailed
      copy "$(ProjectDir)*.cs" "%25KPPTempDir%25"
      if errorlevel 1 goto BuildEventFailed
      copy "$(ProjectDir)$(ProjectName).csproj" "%25KPPTempDir%25\$(ProjectName).csproj"
      if errorlevel 1 goto BuildEventFailed
      mkdir "%25KPPTempDir%25\Forms"
      copy "$(ProjectDir)Forms\*.cs" "%25KPPTempDir%25\Forms"
      copy "$(ProjectDir)Forms\*.resx" "%25KPPTempDir%25\Forms"
      if errorlevel 1 goto BuildEventFailed
      mkdir "%25KPPTempDir%25\Properties"
      copy "$(ProjectDir)Properties\AssemblyInfo.cs" "%25KPPTempDir%25\Properties\AssemblyInfo.cs"
      copy "$(ProjectDir)Properties\Resources.resx" "%25KPPTempDir%25\Properties\Resources.resx"
      copy "$(ProjectDir)Properties\Resources.Designer.cs" "%25KPPTempDir%25\Properties\Resources.Designer.cs"
      mkdir "%25KPPTempDir%25\Resources"
      copy "$(ProjectDir)Resources\*.png" "%25KPPTempDir%25\Resources"
      copy "$(ProjectDir)Resources\*.ico" "%25KPPTempDir%25\Resources"
      if errorlevel 1 goto BuildEventFailed
      echo Files copied to temporary directory

      REM create the PLGX
      "%25KPDir%25KeePass.exe" --plgx-create "%25KPPTempDir%25" --plgx-prereq-kp:2.34
      if errorlevel 1 goto BuildEventFailed
      echo PLGX created

      REM delete the temporary directory and its contents
      rem rmdir /S /Q "%25KPPTempDir%25"
      if errorlevel 1 goto BuildEventFailed
      echo Temporary directory deleted

      goto BuildEventOK


      :NotReleasePlgx
      echo Invalid configuration selected. Please choose a different build configuration
      echo or modify the post-build script to add support for this configuration.

      :BuildEventFailed
      echo POSTBUILDSTEP for $(ProjectName) FAILED
      exit 1

      :BuildEventOK
      echo POSTBUILDSTEP for $(ProjectName) COMPLETED OK</PostBuildEvent>
  </PropertyGroup>
</Project>
